<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="author" content="Webmaster" />
    <meta name="robots" content="index, follow"/>

    <meta property="og:title" content="OpenStack Ceilometer basics"/>
    <meta property="og:url" content="../../../posts/2015/08/openstack-ceilometer-basics.html"/>
    <meta property="og:site_name" content="IT.met.no"/>
    <meta property="og:type" content="article"/>

    <link rel="canonical" href="../../../posts/2015/08/openstack-ceilometer-basics.html" />

    <title>OpenStack Ceilometer basics | IT.met.no</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" />
    <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" />

    <link rel="stylesheet" type="text/css" href="../../../theme/css/main.css" />
    <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="IT.met.no Atom Feed" />

    <script type="text/javascript">var switchTo5x=true;</script>
    <script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
    <script type="text/javascript">
        stLight.options({
            publisher: "",
            doNotHash: false,
            doNotCopy: false,
            hashAddressBar: false
        });
    </script>
</head>

<body id="index">
    <div class="row-fluid">
        <div class="span10 offset1">
            <header id="banner" >
                <h1>
                    <a href="../../../">IT.met.no </a>
                </h1>
                <nav class="navbar">
                    <div class="navbar-inner">
                        <ul class="nav">
                            <li ><a href="/index.html">home</a></li>
                            <li ><a href="/pages/about.html">about</a></li>
                            <li ><a href="/pages/howto.html">howto</a></li>
                            <li ><a href="#">|</a></li>
                            <li class="active"><a href="../../../category/blog.html">blog</a></li>
                        </ul>

                    </div>
                </nav>
            </header><!-- /#banner -->
        </div>
    </div>

    <div class="row-fluid">
        <div class="span10 offset1">
            <div class="row-fluid">
<div class="span10 offset1">
  <section>
    <article>
      <header>
        <h1 class="entry-title">
          <a href="../../../posts/2015/08/openstack-ceilometer-basics.html" rel="bookmark"
             title="Permalink to OpenStack Ceilometer basics">OpenStack Ceilometer basics</a></h1>
      </header>
      <div class="entry-content">
<footer class="post-info">
    <address class="vcard author">
        by <a class="url fn" href="../../../author/mortenhanshaugenmetno.html">morten.hanshaugen@met.no</a>
    </address>

    in <a href="../../../category/blog.html">blog</a>

    on 2015-08-24

        |
        tags:         <a href="../../../tag/openstack.html">openstack</a>
        <a href="../../../tag/ceilometer.html">ceilometer</a>
        <a href="../../../tag/telemetry.html">telemetry</a>
        <a href="../../../tag/api.html">api</a>
        <a href="../../../tag/devstack.html">devstack</a>
        <a href="../../../tag/nova.html">nova</a>
        <a href="../../../tag/contribute.html">contribute</a>



    
</footer><!-- /.post-info -->

        <div style="float:right;margin:0 10px 10px 0">
<p><img alt="The Ceilometer" src="../../../images/Single_Lens_Ceilometer.JPG" /></p>
</div>
<h2>Ceilometer - OpenStack Telemetry</h2>
<p>OpenStack uses Ceilometer to measure Cloud usage.</p>
<p>Telemetry is nice, as infrastructure utilization gets visible to users, developers, project leaders, management and to the IT department for utilization and budgetary purposes.</p>
<h3>Telemetry for OpenStack</h3>
<p>Getting telemetry from OpenStack quickly changed from optimism to frustration. 
OpenStack has all of these really nice APIs you can use to query all kinds of information, but there is no mature project for setting it in a system - and we really did not want to start writing a Cloud accounting system from scratch.</p>
<h4>Simple start - the API</h4>
<p>How to do it could be better documented. Let's walk through the basics.</p>
<p>iFirst we need to get a token:</p>
<div class="highlight"><pre>. openrc    <span class="c"># openrc sets a number of useful variables</span>
<span class="nb">echo</span> <span class="nv">$OS_AUTH_URL</span>
http://localhost:5000/v2.0
</pre></div>


<p>Get and store the adminURL in the ADMIN_URL variable (using quick and dirty method):</p>
<div class="highlight"><pre><span class="nv">ADMIN_URL</span><span class="o">=</span><span class="sb">`</span>curl -s -X POST <span class="nv">$OS_AUTH_URL</span>/tokens -H <span class="s2">&quot;Content-Type: application/json&quot;</span> -d <span class="s1">&#39;{&quot;auth&quot;: {&quot;tenantName&quot;: &quot;&#39;</span><span class="s2">&quot;</span><span class="nv">$OS_TENANT_NAME</span><span class="s2">&quot;</span><span class="s1">&#39;&quot;, &quot;passwordCredentials&quot;: {&quot;username&quot;: &quot;&#39;</span><span class="s2">&quot;</span><span class="nv">$OS_USERNAME</span><span class="s2">&quot;</span><span class="s1">&#39;&quot;, &quot;password&quot;: &quot;&#39;</span><span class="s2">&quot;</span><span class="nv">$OS_PASSWORD</span><span class="s2">&quot;</span><span class="s1">&#39;&quot;}}}&#39;</span> <span class="p">|</span> python -c <span class="s1">&#39;import sys, json; print json.load(sys.stdin)[&quot;access&quot;][&quot;serviceCatalog&quot;][3][&quot;endpoints&quot;][0][&quot;adminURL&quot;]&#39;</span><span class="sb">`</span>v<span class="nv">$OS_VOLUME_API_VERSION</span>/
<span class="nb">echo</span> <span class="nv">$ADMIN_URL</span>
http://localhost:8777/v2/

<span class="nv">TOKEN</span><span class="o">=</span><span class="sb">`</span>curl -s -X POST <span class="nv">$OS_AUTH_URL</span>/tokens -H <span class="s2">&quot;Content-Type: application/json&quot;</span> -d <span class="s1">&#39;{&quot;auth&quot;: {&quot;tenantName&quot;: &quot;&#39;</span><span class="s2">&quot;</span><span class="nv">$OS_TENANT_NAME</span><span class="s2">&quot;</span><span class="s1">&#39;&quot;, &quot;passwordCredentials&quot;: {&quot;username&quot;: &quot;&#39;</span><span class="s2">&quot;</span><span class="nv">$OS_USERNAME</span><span class="s2">&quot;</span><span class="s1">&#39;&quot;, &quot;password&quot;: &quot;&#39;</span><span class="s2">&quot;</span><span class="nv">$OS_PASSWORD</span><span class="s2">&quot;</span><span class="s1">&#39;&quot;}}}&#39;</span> <span class="p">|</span> python -c <span class="s1">&#39;import sys, json; print json.load(sys.stdin)[&quot;access&quot;][&quot;token&quot;][&quot;id&quot;]&#39;</span><span class="sb">`</span>

<span class="nb">echo</span> <span class="nv">$TOKEN</span>
3df105345ada4460b16ee11c06617cf7
</pre></div>


<p>Please note that the tests below will not output anything useful if you have a newly installed OpenStack/Devstack with no data / instances in the database.</p>
<p>Run a quick test listing of available meters:</p>
<div class="highlight"><pre>curl -H X-Auth-Token:<span class="nv">$TOKEN</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">ADMIN_URL</span><span class="si">}</span><span class="s2">meters&quot;</span> <span class="p">|</span> python -m json.tool<span class="p">|</span>grep name<span class="p">|</span>head -3
        <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;network.incoming.packets&quot;</span>,
        <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;network.outgoing.bytes&quot;</span>,
        <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;network.outgoing.packets&quot;</span>,
</pre></div>


<p>Query the list of instances: </p>
<div class="highlight"><pre>curl -H X-Auth-Token:<span class="nv">$TOKEN</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">ADMIN_URL</span><span class="si">}</span><span class="s2">meters/instance?q.field=metadata.event_type&amp;q.value=compute.instance.exists&quot;</span> <span class="p">|</span> python -m json.tool <span class="p">|</span> head
<span class="o">[</span>
    <span class="o">{</span>
        <span class="s2">&quot;counter_name&quot;</span>: <span class="s2">&quot;instance&quot;</span>,
        <span class="s2">&quot;counter_type&quot;</span>: <span class="s2">&quot;gauge&quot;</span>,
        <span class="s2">&quot;counter_unit&quot;</span>: <span class="s2">&quot;instance&quot;</span>,
        <span class="s2">&quot;counter_volume&quot;</span>: 1.0,
        <span class="s2">&quot;message_id&quot;</span>: <span class="s2">&quot;132e401a-26e2-11e5-8ca8-fef0e2547b3a&quot;</span>,
        <span class="s2">&quot;project_id&quot;</span>: <span class="s2">&quot;08b96944c51e45cc847b2a1901ec58c0&quot;</span>,
        <span class="s2">&quot;recorded_at&quot;</span>: <span class="s2">&quot;2015-07-10T09:00:13.117000&quot;</span>,
        <span class="s2">&quot;resource_id&quot;</span>: <span class="s2">&quot;ca3a8684-f406-464d-8ae4-10982613db0e&quot;</span>,
</pre></div>


<p>Query the list of instances where timestamp is newer than a date: </p>
<div class="highlight"><pre>curl -X GET -H X-Auth-Token:<span class="nv">$TOKEN</span> -H <span class="s2">&quot;Content-Type: application/json&quot;</span> -d <span class="s1">&#39;{&quot;q&quot;: [{&quot;field&quot;: &quot;timestamp&quot;, &quot;op&quot;: &quot;ge&quot;, &quot;value&quot;: &quot;2014-04-01T13:34:17&quot;}]}&#39;</span> <span class="si">${</span><span class="nv">ADMIN_URL</span><span class="si">}</span>meters/instance <span class="p">|</span> python -m json.tool
&lt;the same as above&gt;
</pre></div>


<p>A last example to help you along:</p>
<div class="highlight"><pre>curl -X GET -H X-Auth-Token:<span class="nv">$TOKEN</span> -H <span class="s2">&quot;Content-Type: application/json&quot;</span> -d <span class="s1">&#39;{&quot;q&quot;: [{&quot;field&quot;: &quot;timestamp&quot;, &quot;op&quot;: &quot;ge&quot;, &quot;value&quot;: &quot;2014-04-01T13:34:17&quot;}, {&quot;field&quot;: &quot;resource_id&quot;, &quot;op&quot;: &quot;eq&quot;, &quot;value&quot;: &quot;82a1371d-a1a3-4f98-9781-8663b262ee7e&quot;}]}&#39;</span> <span class="si">${</span><span class="nv">ADMIN_URL</span><span class="si">}</span>meters/instance
</pre></div>


<p>See this link for examples of how to use the API:
<a href="http://docs.openstack.org/developer/ceilometer/webapi/v2.html#api-queries">http://docs.openstack.org/developer/ceilometer/webapi/v2.html#api-queries</a></p>
<h4>Command line clients</h4>
<p>See OpenStack command-line clients for detail on how to install command line clients and getting credentials:
<a href="http://docs.openstack.org/api/quick-start/content/index.html#getting-credentials-a00665">http://docs.openstack.org/api/quick-start/content/index.html#getting-credentials-a00665</a></p>
<div class="highlight"><pre>nova image-list
nova flavor-list
etc
</pre></div>


<h3>In need of a Ceilometer project to contribute to</h3>
<p>We master the basics. How to find an OpenStack Ceilometer project to adapt and contribute to?</p>

      </div><!-- /.entry-content -->

    </article>
  </section>
</div>
            </div>
        </div>
    </div>

    <footer id="site-footer">
        <div class="row-fluid">
            <div class="span10 offset1">
                <address>
                    <p>
                        This blog is proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                    </p>
                    <p>
                        <a href="http://github.com/jsliang/pelican-fresh/">Fresh</a> is a responsive theme designed by <a href="http://jsliang.com/">jsliang</a> and <a href="https://github.com/jsliang/pelican-fresh/graphs/contributors">contributors</a>.
                        Special thanks to <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a> and <a href="http://getbootstrap.com/">Twitter Bootstrap</a>.
                    </p>
                </address>
            </div>
        </div>
    </footer>

    <script src="//code.jquery.com/jquery.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>
</body>
</html>