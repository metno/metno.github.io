<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="author" content="Webmaster" />
    <meta name="robots" content="index, follow"/>

    <meta property="og:title" content="Google Web App using Spreadsheet"/>
    <meta property="og:url" content="../../../posts/2015/08/google-web-app-using-spreadsheet.html"/>
    <meta property="og:site_name" content="IT.met.no"/>
    <meta property="og:type" content="article"/>

    <link rel="canonical" href="../../../posts/2015/08/google-web-app-using-spreadsheet.html" />

    <title>Google Web App using Spreadsheet | IT.met.no</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" />
    <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" />

    <link rel="stylesheet" type="text/css" href="../../../theme/css/main.css" />
    <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="IT.met.no Atom Feed" />

    <script type="text/javascript">var switchTo5x=true;</script>
    <script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
    <script type="text/javascript">
        stLight.options({
            publisher: "",
            doNotHash: false,
            doNotCopy: false,
            hashAddressBar: false
        });
    </script>
</head>

<body id="index">
    <div class="row-fluid">
        <div class="span10 offset1">
            <header id="banner" >
                <h1>
                    <a href="../../../">IT.met.no </a>
                </h1>
                <nav class="navbar">
                    <div class="navbar-inner">
                        <ul class="nav">
                            <li ><a href="/index.html">home</a></li>
                            <li ><a href="/pages/about.html">about</a></li>
                            <li ><a href="/pages/howto.html">howto</a></li>
                            <li ><a href="#">|</a></li>
                            <li class="active"><a href="../../../category/blog.html">blog</a></li>
                        </ul>

                    </div>
                </nav>
            </header><!-- /#banner -->
        </div>
    </div>

    <div class="row-fluid">
        <div class="span10 offset1">
            <div class="row-fluid">
<div class="span10 offset1">
  <section>
    <article>
      <header>
        <h1 class="entry-title">
          <a href="../../../posts/2015/08/google-web-app-using-spreadsheet.html" rel="bookmark"
             title="Permalink to Google Web App using Spreadsheet">Google Web App using Spreadsheet</a></h1>
      </header>
      <div class="entry-content">
<footer class="post-info">
    <address class="vcard author">
        by <a class="url fn" href="../../../author/mortenhanshaugenmetno.html">morten.hanshaugen@met.no</a>
    </address>

    in <a href="../../../category/blog.html">blog</a>

    on 2015-08-27

        |
        tags:         <a href="../../../tag/google.html">google</a>
        <a href="../../../tag/web.html">web</a>
        <a href="../../../tag/app.html">app</a>
        <a href="../../../tag/spreadsheet.html">spreadsheet</a>



    
</footer><!-- /.post-info -->

        <h2>Best of both worlds (Spreadsheet and dynamic Web interface)</h2>
<p>Managing information is a challenge. Often times you end up pasting information into a Spreadsheet, you try to make a system out of the madness.. Google comes along offering you an online (Google) Spreadsheet - so you can share your Spreadsheet with colleges! Your co-workers can help you out, thats nice, but you risk ending up with a mess! Just maybe you are better off limiting access to messing up the somewhat valuable Google Spreadsheet data to a smaller group of colleges, while less involved colleagues collaborate via a simple Web based user interface? As Google Spreadsheets are Web based by nature, attaching a Web interface is not far away. This is how you do it:</p>
<h2>Create a Google Spreadsheet</h2>
<p>This one you will have to figure out yourself :)
(drive.google.com -&gt; "New" -&gt; "Sheets")</p>
<h2>Create a Web interface (a "Script")</h2>
<p>After naming your Google Spreadsheet, click "Tools" -&gt; "Script editor.." . Then, from the "Google Apps Script" popup, you select "Web App".</p>
<p>Four files are provided for you:
 * index.hml - Template HTML
 * Stylesheet.html - Style statements
 * Code.gs - JavaScript code that will be executed server side
 * JavaScript.html - Client side JavaScript making required server side calls</p>
<p>The first thing to do is to replace "Untitled project" with a real project name, i.e "Web App Test 1".</p>
<p>You can play with the displayed example code, or you can move right on to interact with your Google Spreadsheet:</p>
<p>In the Spreadsheet, add some text to the upper left most cell, i.e "Cell One" - this is the text we will retrieve in the Web App shortly.</p>
<p>Replace the contents of Index.html with this:</p>
<div class="highlight"><pre><span class="c">&lt;!--</span> <span class="nx">Use</span> <span class="nx">a</span> <span class="nx">templated</span> <span class="nx">HTML</span> <span class="nx">printing</span> <span class="nx">scriptlet</span> <span class="nx">to</span> <span class="kr">import</span> <span class="nx">common</span> <span class="nx">stylesheet</span><span class="p">.</span> <span class="o">--&gt;</span>
<span class="o">&lt;?!=</span> <span class="nx">HtmlService</span><span class="p">.</span><span class="nx">createHtmlOutputFromFile</span><span class="p">(</span><span class="s1">&#39;Stylesheet&#39;</span><span class="p">).</span><span class="nx">getContent</span><span class="p">();</span> <span class="o">?&gt;</span>
<span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span>
    <span class="nx">Reading</span> <span class="nx">data</span> <span class="nx">from</span> <span class="nx">the</span> <span class="nx">Google</span> <span class="nx">Spreadsheet</span><span class="o">:</span>
    <span class="o">&lt;</span><span class="err">/h1&gt;</span>
    <span class="o">&lt;</span><span class="nx">h1</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;main-heading&quot;</span><span class="o">&gt;</span><span class="nx">Loading</span><span class="p">...</span><span class="o">&lt;</span><span class="err">/h1&gt;</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;block result-display&quot;</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;results&quot;</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;error-message&quot;</span><span class="o">&gt;</span>
        <span class="nx">Verify</span> <span class="nx">that</span> <span class="nx">you</span> <span class="nx">have</span> <span class="nx">permission</span> <span class="nx">to</span> <span class="nx">access</span> <span class="k">this</span> <span class="nx">spreadsheet</span><span class="p">..</span>
      <span class="o">&lt;</span><span class="err">/div&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
  <span class="o">&lt;</span><span class="err">/body&gt;</span>
<span class="o">&lt;</span><span class="err">/html&gt;</span>

<span class="c">&lt;!--</span> <span class="nx">Store</span> <span class="nx">data</span> <span class="nx">passed</span> <span class="nx">to</span> <span class="nx">template</span> <span class="nx">here</span><span class="p">,</span> <span class="nx">so</span> <span class="nx">it</span> <span class="nx">is</span> <span class="nx">available</span> <span class="nx">to</span> <span class="nx">the</span>
     <span class="nx">imported</span> <span class="nx">JavaScript</span><span class="p">.</span> <span class="o">--&gt;</span>
<span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="err">/script&gt;</span>

<span class="c">&lt;!--</span> <span class="nx">Use</span> <span class="nx">a</span> <span class="nx">templated</span> <span class="nx">HTML</span> <span class="nx">printing</span> <span class="nx">scriptlet</span> <span class="nx">to</span> <span class="kr">import</span> <span class="nx">JavaScript</span><span class="p">.</span> <span class="o">--&gt;</span>
<span class="o">&lt;?!=</span> <span class="nx">HtmlService</span><span class="p">.</span><span class="nx">createHtmlOutputFromFile</span><span class="p">(</span><span class="s1">&#39;JavaScript&#39;</span><span class="p">).</span><span class="nx">getContent</span><span class="p">();</span> <span class="o">?&gt;</span>
</pre></div>


<p>Replace the contents of JavaScript.html with this: </p>
<div class="highlight"><pre><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js&quot;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
<span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
  <span class="cm">/**</span>
<span class="cm">   * Run initializations on web app load.</span>
<span class="cm">   */</span>
  <span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Call the server here to retrieve any information needed to build the page.</span>
    <span class="nx">google</span><span class="p">.</span><span class="nx">script</span><span class="p">.</span><span class="nx">run</span>
       <span class="p">.</span><span class="nx">withSuccessHandler</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">contents</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Respond to success conditions here.</span>
            <span class="nx">updateCellDisplay</span><span class="p">(</span><span class="nx">contents</span><span class="p">);</span>
          <span class="p">})</span>
       <span class="p">.</span><span class="nx">withFailureHandler</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Respond to failure conditions here.</span>
            <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#main-heading&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
            <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#main-heading&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">);</span>
            <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#error-message&#39;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
          <span class="p">})</span>
          <span class="p">.</span><span class="nx">getCellContents</span><span class="p">();</span>
  <span class="p">});</span>

  <span class="kd">function</span> <span class="nx">updateCellDisplay</span><span class="p">(</span><span class="nx">contents</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">headingText</span> <span class="o">=</span> <span class="s2">&quot;Displaying contents for cell &quot;</span> <span class="o">+</span> <span class="nx">contents</span><span class="p">.</span><span class="nx">cellCoords</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="p">;</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#main-heading&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">headingText</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#results&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;&lt;div&gt;&#39;</span> <span class="o">+</span> <span class="nx">contents</span><span class="p">.</span><span class="nx">value</span> <span class="o">+</span> <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="o">&lt;</span><span class="err">/script&gt;</span>
</pre></div>


<p>Replace the contents of Code.gs with this:</p>
<div class="highlight"><pre><span class="cm">/**</span>
<span class="cm"> * Serves HTML of the application for HTTP GET requests.</span>
<span class="cm"> *</span>
<span class="cm"> * @param {Object} e event parameter that can contain information</span>
<span class="cm"> *     about any URL parameters provided.</span>
<span class="cm"> */</span>
<span class="kd">function</span> <span class="nx">doGet</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// The original example code:</span>
  <span class="kd">var</span> <span class="nx">template</span> <span class="o">=</span> <span class="nx">HtmlService</span><span class="p">.</span><span class="nx">createTemplateFromFile</span><span class="p">(</span><span class="s1">&#39;Index&#39;</span><span class="p">);</span>

  <span class="c1">// Build and return HTML in IFRAME sandbox mode.</span>
  <span class="k">return</span> <span class="nx">template</span><span class="p">.</span><span class="nx">evaluate</span><span class="p">()</span>
      <span class="p">.</span><span class="nx">setTitle</span><span class="p">(</span><span class="s1">&#39;Web App Window Title&#39;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">setSandboxMode</span><span class="p">(</span><span class="nx">HtmlService</span><span class="p">.</span><span class="nx">SandboxMode</span><span class="p">.</span><span class="nx">IFRAME</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">getCellContents</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">contents</span> <span class="o">=</span> <span class="p">{};</span>

  <span class="c1">// Get hold of the spreadsheet.</span>
  <span class="kd">var</span> <span class="nx">ns</span> <span class="o">=</span> <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nx">openById</span><span class="p">(</span><span class="s2">&quot;&lt;the id of the spreadsheet&gt;&quot;</span><span class="p">);</span> <span class="c1">// Named spreadsheet</span>
  <span class="kd">var</span> <span class="nx">nt</span> <span class="o">=</span> <span class="nx">ns</span><span class="p">.</span><span class="nx">getSheetByName</span><span class="p">(</span><span class="s2">&quot;Sheet1&quot;</span><span class="p">);</span> <span class="c1">// Named Tab</span>
  <span class="nx">contents</span><span class="p">.</span><span class="nx">cellCoords</span> <span class="o">=</span> <span class="s2">&quot;1, 1&quot;</span><span class="p">;</span> <span class="c1">// Static info text</span>
  <span class="nx">contents</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">nt</span><span class="p">.</span><span class="nx">getRange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="nx">getValue</span><span class="p">();</span> <span class="c1">// Get value of the cell</span>

  <span class="k">return</span> <span class="nx">contents</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>Please note that "&lt;the id if the spreadsheet&gt;" will be "xyzabc" if the URL of the spreadsheet is "https://docs.google.com/spreadsheets/d/xyzabc/edit#gid=0".</p>
<p>Make sure you save all the "files" (press the small floppy disc icon or press Control-S).</p>
<h3>Publish as a Web app</h3>
<p>Click on Menu choice "Publish" -&gt; "Deploy as web app...".
Fill in a comment about the app, and leave the rest to default values (the app will run as your user, only you have access to the app (at least as long as you are just testing, right?)). Press "Deploy".</p>
<p>What immediately happens, is that Google notifies you that this App has to be Authenticated: "Authorization required. This app needs authorization to run.". Continue and press "Accept", and you get the message: "This project is now deployed as a web app." and you get a link to the Web page: "https://script.google.com/macros/s/FOOBARBAZ/exec", and you get the choice to "Test web app for your latest code.". Go on and press the link. If you did exactly as specified, a new browser tab opens and you will see the following:</p>
<div class="highlight"><pre>Reading data from the Google Spreadsheet:

Displaying contents for cell 1, 1

Cell One
</pre></div>


<h2>Ground work is in place</h2>
<p>The Web application has retrieved information from our Google Spreadsheet! The app has full access to insert data into the spreadsheet, to present data from the spreadsheet, to create sums, insert new tabs, etc, making it possible for you to tailor what data in the spreadsheet other users should be allowed to manipulate.</p>
<h1>Go on write your App!</h1>
<p>Good luck writing your application!</p>

      </div><!-- /.entry-content -->

    </article>
  </section>
</div>
            </div>
        </div>
    </div>

    <footer id="site-footer">
        <div class="row-fluid">
            <div class="span10 offset1">
                <address>
                    <p>
                        This blog is proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                    </p>
                    <p>
                        <a href="http://github.com/jsliang/pelican-fresh/">Fresh</a> is a responsive theme designed by <a href="http://jsliang.com/">jsliang</a> and <a href="https://github.com/jsliang/pelican-fresh/graphs/contributors">contributors</a>.
                        Special thanks to <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a> and <a href="http://getbootstrap.com/">Twitter Bootstrap</a>.
                    </p>
                </address>
            </div>
        </div>
    </footer>

    <script src="//code.jquery.com/jquery.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>
</body>
</html>